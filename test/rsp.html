<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rsp</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="./icon.png">
    <link rel="apple-touch-icon" href="./icon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  </head>
  <body>
    <!-- Floating table of contents -->
    <div id="toc"></div>
    <div id="top"></div>
    <button id="expandButton">▼</button>
    <div class="container">
      <h1>Rechtsprechung</h1>
      <h5> </h5>
      <div class="columns paragraph">
        <div class="left">
          <h4 id="S001">§&nbsp;1 Schutzgegenstand</h4>
        </div>
        <div class="right"></div>
        <div class="left">(1)&emsp;Für dreidimensionale Strukturen von mikroelektronischen Halbleitererzeugnissen (Topographien) kann auf Antrag Schutz nach diesem Bundesgesetz erworben werden, wenn und soweit sie Eigenart (<a href="#S002">§&nbsp;2</a>) aufweisen.</div>
        <div class="right"></div>
      </div>
      <div id="summary" class="paragraph">
      </div>
      
      <div class="columns">
        <div class="wide epilog">
          <a href="https://www.github.com">Quellcode</a>
        </div>
      </div>

      <script src="script.js"></script>
       <script>
        // List of pages to scrape
        const pages = ['patg.html', 'gmg.html', 'schzg.html', 'mschg.html', 'muschg.html'];

        // Function to extract case law from HTML content
        function extractCaseLaw(htmlContent, pageName) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlContent, 'text/html');
            const caseLawEntries = [];

            // Find all <a> tags inside .wide > p
            const links = doc.querySelectorAll('.wide p a');
            links.forEach(link => {
                const text = link.textContent.trim();
                // Updated regex to match the case law format:
                // 1. Court (e.g., "OGH", "OLG Wien", "BGH")
                // 2. Date (e.g., "12.04.2024")
                // 3. ID (any combination of letters, numbers, forward slashes, and dashes)
                const regex = /^([A-Z][a-zA-Z\s]*)\s(\d{2}\.\d{2}\.\d{4}),\s([A-Za-z0-9\/\-]+)/;
                const match = text.match(regex);

                if (match) {
                    const court = match[1];
                    const date = match[2];
                    const id = match[3];
                    // Extract the section ID (e.g., "S001" from the previous <h4>)
                    const section = link.closest('.wide').previousElementSibling.querySelector('h4').id;
                    caseLawEntries.push({
                        court: court,
                        date: date,
                        id: id,
                        section: section,
                        page: pageName
                    });
                }
            });

            return caseLawEntries;
        }

        // Function to sort case law by court and date
        function sortCaseLaw(entries) {
            return entries.sort((a, b) => {
                // Sort by court
                if (a.court !== b.court) {
                    return a.court.localeCompare(b.court);
                }

                // Extract date components (DD.MM.YYYY)
                const [dayA, monthA, yearA] = a.date.split('.').map(Number);
                const [dayB, monthB, yearB] = b.date.split('.').map(Number);

                // Sort by date (chronologically)
                if (yearA !== yearB) return yearA - yearB;
                if (monthA !== monthB) return monthA - monthB;
                return dayA - dayB;
            });
        }

        // Function to display the sorted case law
        function displayCaseLaw(entries) {
            const summaryDiv = document.getElementById('summary');
            let currentCourt = null;

            entries.forEach(entry => {
                if (entry.court !== currentCourt) {
                    currentCourt = entry.court;
                    const courtHeading = document.createElement('h3');
                    courtHeading.textContent = currentCourt;
                    summaryDiv.appendChild(courtHeading);
                }

                const caseEntry = document.createElement('div');
                caseEntry.className = 'case-entry';
                caseEntry.innerHTML = `
                    <h4 id="${entry.id}">${entry.court} ${entry.date}, ${entry.id}</h4>
                    <p>Siehe <a href="${entry.page}#${entry.section}">§&nbsp;${entry.section.replace('S', '')} ${entry.page}</a>.</p>
                `;
                summaryDiv.appendChild(caseEntry);
            });
        }

        // Load all pages and process their content
        async function loadAndProcessPages() {
            const allEntries = [];
            for (const page of pages) {
                try {
                    const response = await fetch(page);
                    const htmlContent = await response.text();
                    const entries = extractCaseLaw(htmlContent, page);
                    allEntries.push(...entries);
                } catch (error) {
                    console.error(`Error loading ${page}:`, error);
                }
            }

            // Sort and display the case law
            const sortedEntries = sortCaseLaw(allEntries);
            displayCaseLaw(sortedEntries);
            
            // fill toc
            const toc = document.getElementById("toc");
            const allHeadings = document.querySelectorAll("h2, h3, h4");
    const headings = Array.from(allHeadings).filter(heading => !heading.classList.contains('not_toc'));

	const list = document.createElement("p");
	
	  // Determine if there are any h2 elements
    //const hasH2 = Array.from(headings).some(heading => heading.tagName === "H2");
    
    var indentH3 = 0;
    var indentH4 = 1;
    const indentPixel = 20;
    
	headings.forEach(heading => {
		const li = document.createElement("p");
		li.style.margin = "6px";
		const a = document.createElement("a");
		a.href = "#" + heading.id;
		
        if (heading.tagName === "H2") {
            li.style.marginLeft = "0px"; // immer null
            li.style.fontWeight = "bold";
            a.innerHTML = heading.innerHTML.toUpperCase();
            indentH3 = 1;
            indentH4 = 1;
        } else if (heading.tagName === "H3") {
            li.style.marginLeft = indentH3 * indentPixel + "px";
            li.style.fontWeight = "bold";
            a.innerHTML = heading.innerHTML;
            if (indentH3 == 1) {
                indentH4 = 2;
            }
        } else if (heading.tagName === "H4") {
            li.style.marginLeft = indentH4 * indentPixel + "px";
            
            const originalText = heading.innerHTML;
            const regex = /^(§|Art\.)&nbsp;([0-9]+[a-z]*)(?:<sup>[^<]*<\/sup>)?/i;
            const match = originalText.match(regex);

            if (match && !heading.classList.contains("gestrichen")) {
                const prefixAndNumber = match[0]; // The matched prefix and number/letter
                const restOfText = originalText.slice(prefixAndNumber.length); // The rest of the text

                // Wrap the prefix and number in <strong> tags
                heading.innerHTML = `<strong>${prefixAndNumber}</strong>${restOfText}`;
                //console.log(heading.innerHTML);
            }
            //console.log("test")
            
            a.innerHTML = heading.innerHTML;
        }
        
		li.appendChild(a);
		list.appendChild(li);
		
	});
	toc.appendChild(list);
        }

        // Run the script when the page loads
        window.onload = loadAndProcessPages;
    </script>
      </body>
    </html>

