<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rsp</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="./icon.png">
    <link rel="apple-touch-icon" href="./icon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  </head>
  <body>
    <!-- Floating table of contents -->
    <div id="toc"></div>
    <div id="top"></div>
    <button id="expandButton">▼</button>
    <div class="container">
      <h1>Rechtsprechung</h1>
      <h5>Eine automatisiert generierte Liste.</h5>
      
      <div id="summary"></div>
      
      <div class="columns">
        <div class="wide epilog">
          <a href="https://www.github.com">Quellcode</a>
        </div>
      </div>

      
       <script>
        // List of pages to scrape
        const pages = ['patg.html', 'gmg.html', 'schzg.html', 'mschg.html', 'muschg.html', 'zustg.html'];
        const pageNames = {
            'patg.html': 'PatG',
            'gmg.html': 'GMG',
            'schzg.html': 'SchZG',
            'mschg.html': 'MSchG',
            'muschg.html': 'MuSchG',
			'zustg.html': 'ZustG'
        };

        // Function to extract case law from HTML content
        function extractCaseLaw(htmlContent, pageName) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlContent, 'text/html');
            const caseLawEntries = [];

            // Find all <a> tags inside .wide > p
            const links = doc.querySelectorAll('.wide p a');
            links.forEach(link => {
                const text = link.textContent.trim();
                // Updated regex to match the case law format:
                // 1. Court (e.g., "OGH", "OLG Wien", "BGH")
                // 2. Date (e.g., "12.04.2024")
                // 3. ID (any combination of letters, numbers, forward slashes, and dashes)
                const regex = /^([A-Z][a-zA-Z\s]*)\s(\d{2}\.\d{2}\.\d{4}),\s([A-Za-z0-9\/\-]+)/;
                const match = text.match(regex);

                if (match) {
                    const court = match[1];
                    const date = match[2];
                    const id = match[3];
                    // Extract the section ID (e.g., "S001" from the previous <h4>)
                    const section = link.closest('.wide').previousElementSibling.querySelector('h4').id;
                    caseLawEntries.push({
                        court: court,
                        date: date,
                        id: id,
                        section: section,
                        page: pageName
                    });
                }
            });

            return caseLawEntries;
        }

        // Function to sort case law by court and date
        function sortCaseLaw(entries) {
            return entries.sort((a, b) => {
                // Sort by court
                if (a.court !== b.court) {
                    return a.court.localeCompare(b.court);
                }

                // Extract date components (DD.MM.YYYY)
                const [dayA, monthA, yearA] = a.date.split('.').map(Number);
                const [dayB, monthB, yearB] = b.date.split('.').map(Number);

                // Sort by date (chronologically)
                if (yearA !== yearB) return yearA - yearB;
                if (monthA !== monthB) return monthA - monthB;
                return dayA - dayB;
            });
        }

        // Function to display the sorted case law
        function displayCaseLaw(entries) {
            const summaryDiv = document.getElementById('summary');

            // Step 1: Deduplicate and group entries by case law
            const groupedEntries = {};
            entries.forEach(entry => {
                const key = `${entry.court}_${entry.date}_${entry.id}`;
                if (!groupedEntries[key]) {
                    groupedEntries[key] = {
                        court: entry.court,
                        date: entry.date,
                        id: entry.id,
                        sections: []
                    };
                }
                groupedEntries[key].sections.push({
                    section: entry.section.replace('S', '').replace(/^0+/, ''),
                    page: entry.page,
                    originalSection: entry.section // Keep the original section ID for the link
                });
            });

            // Step 2: Sort the grouped entries by court and date
            const sortedKeys = Object.keys(groupedEntries).sort((a, b) => {
                const [courtA, dateA] = a.split('_');
                const [courtB, dateB] = b.split('_');
                if (courtA !== courtB) return courtA.localeCompare(courtB);
                const [dayA, monthA, yearA] = dateA.split('.').map(Number);
                const [dayB, monthB, yearB] = dateB.split('.').map(Number);
                if (yearA !== yearB) return yearA - yearB;
                if (monthA !== monthB) return monthA - monthB;
                return dayA - dayB;
            });

            // Step 3: Display the grouped and sorted case law
            let currentCourt = null;
            sortedKeys.forEach(key => {
                const entry = groupedEntries[key];
                if (entry.court !== currentCourt) {
                    currentCourt = entry.court;
                    const courtDiv = document.createElement('div');
                    courtDiv.className = 'columns';
                    const courtHeading = document.createElement('h3');
					courtHeading.id = currentCourt;
                    courtHeading.textContent = currentCourt;
                    courtDiv.appendChild(courtHeading);
                    summaryDiv.appendChild(courtDiv);
					if (currentCourt == "BGH") {
						const aktenzeichenDiv = document.createElement('div');
						aktenzeichenDiv.className = "wide";
						aktenzeichenDiv.innerHTML = `
							<p>Das Aktenzeichen (z.B. XZR168/00) einer BGH-Entscheidung setzt sich folgendermaßen zusammen:</p>
							<ul>
							<li>X: zuständiger Senat (römische Zahlen für die Zivilsenate, arabische Zahlen für die Strafsenate)</li>
							<li>ZR: Registerzeichen (Revisionen, Berufungen in Patentsachen)</li>
							<li>168: laufende Nummer</li>
							<li>00: zweistelliges Eingangsjahr</li>
							</ul>
						`;
						summaryDiv.appendChild(aktenzeichenDiv);
					}
					if (currentCourt == "EuG") {
						const aktenzeichenDiv = document.createElement('div');
						aktenzeichenDiv.className = "wide";
						aktenzeichenDiv.innerHTML = `
							<p>Das Aktenzeichen (z.B. T-101/15) einer EuG-Entscheidung setzt sich folgendermaßen zusammen:</p>
							<ul>
							<li>T: EuG</li>
							<li>101: laufende Nummer</li>
							<li>15: zweistelliges Eingangsjahr</li>
							</ul>
						`;
						summaryDiv.appendChild(aktenzeichenDiv);
					}
					if (currentCourt == "EuGH") {
						const aktenzeichenDiv = document.createElement('div');
						aktenzeichenDiv.className = "wide";
						aktenzeichenDiv.innerHTML = `
							<p>Das Aktenzeichen (z.B. C-49/02) einer EuGH-Entscheidung setzt sich folgendermaßen zusammen:</p>
							<ul>
							<li>C: EuGH</li>
							<li>49: laufende Nummer</li>
							<li>02: zweistelliges Eingangsjahr</li>
							</ul>
						`;
						summaryDiv.appendChild(aktenzeichenDiv);
					}
					if (currentCourt == "OGH") {
						const aktenzeichenDiv = document.createElement('div');
						aktenzeichenDiv.className = "wide";
						aktenzeichenDiv.innerHTML = `
							<p>Das Aktenzeichen (z.B. 17Ob6/08v) einer OGH-Entscheidung setzt sich folgendermaßen zusammen:</p>
							<ul>
							<li>17: Gerichtsabteilung</li>
							<li>Ob: Zivilsachen beim OGH</li>
							<li>ObA: Arbeitsrechtsachen beim OGH</li>
							<li>6: Aktenzahl (laufende Nummer)</li>
							<li>08: zweistelliges Eingangsjahr</li>
							<li>v: Prüfbuchstabe</li>
							</ul>
						`;
						summaryDiv.appendChild(aktenzeichenDiv);
					}
					if (currentCourt == "OLG Wien") {
						const aktenzeichenDiv = document.createElement('div');
						aktenzeichenDiv.className = "wide";
						aktenzeichenDiv.innerHTML = `
							<p>Das Aktenzeichen (z.B. 34R94/14i) einer OLG-Entscheidung setzt sich folgendermaßen zusammen:</p>
							<ul>
							<li>34: Gerichtsabteilung</li>
							<li>R: Zivilsachen beim OLG</li>
							<li>Ra: Arbeitsrechtsachen beim OLG</li>
							<li>94: Aktenzahl (laufende Nummer)</li>
							<li>14: zweistelliges Eingangsjahr</li>
							<li>i: Prüfbuchstabe</li>
							</ul>
						`;
						summaryDiv.appendChild(aktenzeichenDiv);
					}
					if (currentCourt == "OPMS") {
						const aktenzeichenDiv = document.createElement('div');
						aktenzeichenDiv.className = "wide";
						aktenzeichenDiv.innerHTML = `
							<p>Das Aktenzeichen (z.B. OBp1/10, Om1/10, OGM1/10) einer OPMS-Entscheidung setzt sich folgendermaßen zusammen:</p>
							<ul>
							<li>O: Oberster Patent- und Markensenat</li>
							<li>B: Beschwerdeverfahren gegen Endentscheidungen der BA</li>
							<li>kein B: Berufungsverfahren gegen Endentscheidungen der NA</li>
							<li>p / m / GM: Patent, Marke, Gebrauchsmuster</li>
							<li>1: laufende Nummer</li>
							<li>10: zweistelliges Eingangsjahr</li>
							</ul>
						`;
						summaryDiv.appendChild(aktenzeichenDiv);
					}
                }

                const caseEntry = document.createElement('div');
                caseEntry.className = 'case-entry';
                const sectionsList = entry.sections
    .map(s => ({
        text: `§&nbsp;${s.section} ${pageNames[s.page] || s.page}`,
        page: s.page,
        originalSection: s.originalSection
    }))
    // Deduplicate by text
    .filter((s, i, arr) =>
        arr.findIndex(t => t.text === s.text) === i
    )
    // Join with semicolons
    .map(s => `<a href="${s.page}#${s.originalSection}">${s.text}</a>`)
    .join(', ');
                caseEntry.innerHTML = `
                    <div class="paragraph">
                    <h4 id="${entry.id}">${entry.court} ${entry.date}, ${entry.id}</h4>
                    <p>Siehe ${sectionsList}.</p>
                    </div>
                `;
                summaryDiv.appendChild(caseEntry);
            });
        }

        // Load all pages and process their content
        async function loadAndProcessPages() {
            const allEntries = [];
            for (const page of pages) {
                try {
                    const response = await fetch(page);
                    const htmlContent = await response.text();
                    const entries = extractCaseLaw(htmlContent, page);
                    allEntries.push(...entries);
                } catch (error) {
                    console.error(`Error loading ${page}:`, error);
                }
            }

            // Just pass the entries, sorting is done in displayCaseLaw
            displayCaseLaw(allEntries);
            
            // fill toc
            const toc = document.getElementById("toc");
            const allHeadings = document.querySelectorAll("h2, h3, h4");
    const headings = Array.from(allHeadings).filter(heading => !heading.classList.contains('not_toc'));

	const list = document.createElement("div");
	
	  // Determine if there are any h2 elements
    //const hasH2 = Array.from(headings).some(heading => heading.tagName === "H2");
    
    var indentH3 = 0;
    var indentH4 = 1;
    const indentPixel = 20;
    
	headings.forEach(heading => {
		const li = document.createElement("p");
		li.style.margin = "6px";
		const a = document.createElement("a");
		a.href = "#" + heading.id;
		
        if (heading.tagName === "H2") {
            li.style.marginLeft = "0px"; // immer null
            li.style.fontWeight = "bold";
            a.innerHTML = heading.innerHTML.toUpperCase();
            indentH3 = 1;
            indentH4 = 1;
        } else if (heading.tagName === "H3") {
            li.style.marginLeft = indentH3 * indentPixel + "px";
            li.style.fontWeight = "bold";
            a.innerHTML = heading.innerHTML;
            if (indentH3 == 1) {
                indentH4 = 2;
            }
        } else if (heading.tagName === "H4") {
    li.style.marginLeft = indentH4 * indentPixel + "px";
    // Extract only the date and ID from the heading text
    const regex = /([A-Z][a-zA-Z\s]*)\s(\d{2}\.\d{2}\.\d{4}),\s([A-Za-z0-9\/\-]+)/;
    const match = heading.innerHTML.match(regex);
    if (match) {
        const date = match[2];
        const id = match[3];
        a.innerHTML = `${date}, ${id}`;
    } else {
        a.innerHTML = heading.innerHTML; // fallback
    }
}

        
		li.appendChild(a);
		list.appendChild(li);
		
	});
	toc.appendChild(list);
        }

        // Run the script when the page loads
        window.onload = loadAndProcessPages;
    </script>
    <script src="script.js"></script>
      </body>
    </html>

