<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rsp</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="./icon.png">
    <link rel="apple-touch-icon" href="./icon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  </head>
  <body>
    <header>
      <nav class="navbar">
        <div class="nav-left"></div>
        <button id="nav-button"></button>
      </nav>
    </header>
    <div id="toc"></div>
    <div class="container" id="summary">
      <h1>Rechtsprechung</h1>
      <h5>Eine automatisiert generierte Liste.</h5>
	</div>
	  
       <script>
        // List of pages to scrape
        const pages = ['patg.html', 'gmg.html', 'patv-eg.html', 'schzg.html', 'mschg.html', 'muschg.html', 'zustg.html'];
        const pageNames = {
            'patg.html': 'PatG',
            'gmg.html': 'GMG',
            'patv-eg.html': 'PatV-EG',
            'schzg.html': 'SchZG',
            'mschg.html': 'MSchG',
            'muschg.html': 'MuSchG',
			'zustg.html': 'ZustG'
        };

	   // Dictionary for link text based on domain pattern
		const linkLabels = {
		    "ris.bka.gv.at":        'RIS',
		    "rdb.manz.at":          'rdb.at',
		    "bundesgerichtshof.de": 'BGH',
		    "curia.europa.eu":      'Curia',
		    "eur-lex.europa.eu":    'EUR-Lex',
		    "beck-online.beck.de":    'beck-online'
		};

		// Helper function: choose label depending on URL
		function getLinkLabel(url) {
		    for (const pattern in linkLabels) {
		        if (url.includes(pattern)) {
		            return linkLabels[pattern];
		        }
		    }
		    return 'Link zur Entscheidung <i class="fa fa-link"></i>'; // Default
		}

        // Function to extract case law from HTML content
        function extractCaseLaw(htmlContent, pageName) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlContent, 'text/html');
            const caseLawEntries = [];

            // Find all <a> tags inside .wide > p
            const links = doc.querySelectorAll('.wide p a');
            links.forEach(link => {
                const text = link.textContent.trim();
                // Updated regex to match the case law format:
                // 1. Court (e.g., "OGH", "OLG Wien", "BGH")
                // 2. Date (e.g., "12.04.2024")
                // 3. ID (any combination of letters, numbers, forward slashes, and dashes)
                const regex = /^([A-Z][a-zA-Z\s]*)\s(\d{2}\.\d{2}\.\d{4}),\s([A-Za-z0-9\(\)\/\-]+)/;
                const match = text.match(regex);

                if (match) {
                    const court = match[1];
                    const date = match[2];
                    const id = match[3];
                    // Extract the section ID (e.g., "S001" from the previous <h4>)
                    const section = link.closest('.wide').previousElementSibling.querySelector('h4').id;
                    caseLawEntries.push({
                        court: court,
                        date: date,
                        id: id,
                        section: section,
                        page: pageName,
						url: link.getAttribute("href")
                    });
                }
            });

            return caseLawEntries;
        }

        // Function to sort case law by court and date
        function sortCaseLaw(entries) {
            return entries.sort((a, b) => {
                // Sort by court
                if (a.court !== b.court) {
                    return a.court.localeCompare(b.court);
                }

                // Extract date components (DD.MM.YYYY)
                const [dayA, monthA, yearA] = a.date.split('.').map(Number);
                const [dayB, monthB, yearB] = b.date.split('.').map(Number);

                // Sort by date (chronologically)
                if (yearA !== yearB) return yearA - yearB;
                if (monthA !== monthB) return monthA - monthB;
                return dayA - dayB;
            });
        }

        // Function to display the sorted case law
        function displayCaseLaw(entries) {
            const summaryDiv = document.getElementById('summary');

            // Step 1: Deduplicate and group entries by case law
            const groupedEntries = {};
            entries.forEach(entry => {
                const key = `${entry.court}_${entry.date}_${entry.id}`;
                if (!groupedEntries[key]) {
                    groupedEntries[key] = {
                        court: entry.court,
                        date: entry.date,
                        id: entry.id,
            			url: entry.url,
                        sections: []
                    };
                }
                groupedEntries[key].sections.push({
                    section: entry.section.replace('S', '').replace(/^0+/, ''),
                    page: entry.page,
                    originalSection: entry.section // Keep the original section ID for the link
                });
            });

            // Step 2: Sort the grouped entries by court and date
            const sortedKeys = Object.keys(groupedEntries).sort((a, b) => {
                const [courtA, dateA] = a.split('_');
                const [courtB, dateB] = b.split('_');
                if (courtA !== courtB) return courtA.localeCompare(courtB);
                const [dayA, monthA, yearA] = dateA.split('.').map(Number);
                const [dayB, monthB, yearB] = dateB.split('.').map(Number);
                if (yearA !== yearB) return yearA - yearB;
                if (monthA !== monthB) return monthA - monthB;
                return dayA - dayB;
            });

            // Step 3: Display the grouped and sorted case law
            let currentCourt = null;
            sortedKeys.forEach(key => {
                const entry = groupedEntries[key];
                if (entry.court !== currentCourt) {
                    currentCourt = entry.court;
                    const courtDiv = document.createElement('div');
                    courtDiv.className = 'columns';
                    const courtHeading = document.createElement('h3');
					courtHeading.id = currentCourt;
                    courtHeading.textContent = currentCourt;
                    courtDiv.appendChild(courtHeading);
                    summaryDiv.appendChild(courtDiv);
					if (currentCourt == "BA") {
						const aktenzeichenDiv = document.createElement('div');
						aktenzeichenDiv.className = "wide";
						aktenzeichenDiv.innerHTML = `
							<p>Das Aktenzeichen (z.B. B24/86) einer Entscheidung der Beschwerdeabteilung des ÖPA setzt sich folgendermaßen zusammen:</p>
							<ul>
							<li>B: Beschwerdeabteilung</li>
							<li>24: laufende Nummer</li>
							<li>86: zweistelliges Eingangsjahr</li>
							</ul>
						`;
						summaryDiv.appendChild(aktenzeichenDiv);
					}
					if (currentCourt == "BGH") {
						const aktenzeichenDiv = document.createElement('div');
						aktenzeichenDiv.className = "wide";
						aktenzeichenDiv.innerHTML = `
							<p>Das Aktenzeichen (z.B. XZR168/00) einer BGH-Entscheidung setzt sich folgendermaßen zusammen:</p>
							<ul>
							<li>X: zuständiger Senat (römische Zahlen für die Zivilsenate, arabische Zahlen für die Strafsenate)</li>
							<li>ZR: Registerzeichen (Revisionen, Berufungen in Patentsachen)</li>
							<li>168: laufende Nummer</li>
							<li>00: zweistelliges Eingangsjahr</li>
							</ul>
						`;
						summaryDiv.appendChild(aktenzeichenDiv);
					}
					if (currentCourt == "EuG") {
						const aktenzeichenDiv = document.createElement('div');
						aktenzeichenDiv.className = "wide";
						aktenzeichenDiv.innerHTML = `
							<p>Das Aktenzeichen (z.B. T-101/15) einer EuG-Entscheidung setzt sich folgendermaßen zusammen:</p>
							<ul>
							<li>T: EuG</li>
							<li>101: laufende Nummer</li>
							<li>15: zweistelliges Eingangsjahr</li>
							</ul>
						`;
						summaryDiv.appendChild(aktenzeichenDiv);
					}
					if (currentCourt == "EuGH") {
						const aktenzeichenDiv = document.createElement('div');
						aktenzeichenDiv.className = "wide";
						aktenzeichenDiv.innerHTML = `
							<p>Das Aktenzeichen (z.B. C-49/02) einer EuGH-Entscheidung setzt sich folgendermaßen zusammen:</p>
							<ul>
							<li>C: EuGH</li>
							<li>49: laufende Nummer</li>
							<li>02: zweistelliges Eingangsjahr</li>
							</ul>
						`;
						summaryDiv.appendChild(aktenzeichenDiv);
					}
					if (currentCourt == "OGH") {
						const aktenzeichenDiv = document.createElement('div');
						aktenzeichenDiv.className = "wide";
						aktenzeichenDiv.innerHTML = `
							<p>Das Aktenzeichen (z.B. 17Ob6/08v) einer OGH-Entscheidung setzt sich folgendermaßen zusammen:</p>
							<ul>
							<li>17: Gerichtsabteilung</li>
							<li>Ob: Zivilsachen beim OGH</li>
							<li>ObA: Arbeitsrechtsachen beim OGH</li>
							<li>6: Aktenzahl (laufende Nummer)</li>
							<li>08: zweistelliges Eingangsjahr</li>
							<li>v: Prüfbuchstabe</li>
							</ul>
						`;
						summaryDiv.appendChild(aktenzeichenDiv);
					}
					if (currentCourt == "OLG Wien") {
						const aktenzeichenDiv = document.createElement('div');
						aktenzeichenDiv.className = "wide";
						aktenzeichenDiv.innerHTML = `
							<p>Das Aktenzeichen (z.B. 34R94/14i) einer OLG-Entscheidung setzt sich folgendermaßen zusammen:</p>
							<ul>
							<li>34: Gerichtsabteilung</li>
							<li>R: Zivilsachen beim OLG</li>
							<li>Ra: Arbeitsrechtsachen beim OLG</li>
							<li>94: Aktenzahl (laufende Nummer)</li>
							<li>14: zweistelliges Eingangsjahr</li>
							<li>i: Prüfbuchstabe</li>
							</ul>
						`;
						summaryDiv.appendChild(aktenzeichenDiv);
					}
					if (currentCourt == "OPMS") {
						const aktenzeichenDiv = document.createElement('div');
						aktenzeichenDiv.className = "wide";
						aktenzeichenDiv.innerHTML = `
							<p>Das Aktenzeichen (z.B. OBp1/10, Om1/10, OGM1/10) einer OPMS-Entscheidung setzt sich folgendermaßen zusammen:</p>
							<ul>
							<li>O: Oberster Patent- und Markensenat</li>
							<li>B: Beschwerdeverfahren gegen Endentscheidungen der BA</li>
							<li>kein B: Berufungsverfahren gegen Endentscheidungen der NA</li>
							<li>p / m / GM: Patent, Marke, Gebrauchsmuster</li>
							<li>1: laufende Nummer</li>
							<li>10: zweistelliges Eingangsjahr</li>
							</ul>
						`;
						summaryDiv.appendChild(aktenzeichenDiv);
					}
					if (currentCourt == "NA") {
						const aktenzeichenDiv = document.createElement('div');
						aktenzeichenDiv.className = "wide";
						aktenzeichenDiv.innerHTML = `
							<p>Das Aktenzeichen (z.B. N2/98, Nm1/10, NMu1/2011) einer Entscheidung der NA des ÖPA setzt sich folgendermaßen zusammen:</p>
							<ul>
							<li>N: Nichtigkeitsabteilung</li>
                            <li>GM: Gebrauchsmustersachen</li>
							<li>m: Markensachen</li>
                            <li>Mu: Mustersachen</li>
                            <li>kein GM/m/Mu: Patentsachen</li>
							<li>1: laufende Nummer</li>
							<li>98 oder 2011: zwei- oder vierstelliges Eingangsjahr</li>
							</ul>
						`;
						summaryDiv.appendChild(aktenzeichenDiv);
					}
					if (currentCourt == "BPatG") {
						const aktenzeichenDiv = document.createElement('div');
						aktenzeichenDiv.className = "wide";
						aktenzeichenDiv.innerHTML = `
							<p>Das Aktenzeichen (z.B. 25W(pat)168/75) einer BPatG-Entscheidung setzt sich folgendermaßen zusammen:</p>
							<ul>
							<li>25: Senat</li>
                            <ul>
                                <li>1-5: Nichtigkeitssenat</li>
                                <li>6-23, 34: technischer Beschwerdesenat</li>
                                <li>24-33: Marken-Beschwerdesenat</li>
                                <li>35: Gebrauchsmuster-Beschwerdesenat</li>
                                <li>36: Beschwerdesenat für Sortenschutzsachen</li>
                            </ul>
							<li>W(pat): Registerzeichen</li>
                            <ul>
                                <li>AR(pat): allgemeines Register</li>
                                <li>E(pat): Beschwerdeverfahren in Patent-, Design-, Sortenschutz- und Markensachen/li>
                                <li>Li: Zwangslizenzverfahren</li>
                                <li>LiQ: einstweilige Verfügung in Zwangslizenzverfahren</li>
                                <li>LiR: Rücknahmeklagen in Zwangslizenzsachen</li>
                                <li>Ni: Patentnichtigkeitsverfahren</li>
                                <li>W(pat): Beschwerdeverfahren in Patent-, Design-, Gebrauchsmuster-, Sortenschutz- und Markensachen</li>
                                <li>ZA(pat): Verfahren über Anträge außerhalb anhängiger Patentsachen</li>
                                <li>ZS(pat): Verfahren über Anträge außerhalb anhängiger Patentsachen</li>
                            </ul>
							<li>168: laufende Nummer</li>
							<li>75: zweistelliges Eingangsjahr</li>
							</ul>
						`;
						summaryDiv.appendChild(aktenzeichenDiv);
					}
                }

                const paragraph = document.createElement('div');
				paragraph.className = 'paragraph';
                const sectionsList = entry.sections
    .map(s => ({
        text: `§&nbsp;${s.section} ${pageNames[s.page] || s.page}`,
        page: s.page,
        originalSection: s.originalSection
    }))
    // Deduplicate by text
    .filter((s, i, arr) =>
        arr.findIndex(t => t.text === s.text) === i
    )
    // Join with semicolons
    .map(s => `<a href="${s.page}#${s.originalSection}">${s.text}</a>`)
    .join(', ');
                paragraph.innerHTML = `
                    <h4 id="${entry.id}">${entry.court} ${entry.date}, ${entry.id}</h4>
                    <p>Siehe ${sectionsList}.</p>
					<p style="font-style: italic;"><a href="${entry.url}" target="_blank">${getLinkLabel(entry.url)} <i class="fa fa-link" style="line-height: 0.1em;"></i></a></p>
                `;
                summaryDiv.appendChild(paragraph);
            });

			// --- Summary statistics ---
			const summaryH5 = document.querySelector('#summary h5');
			
			const counts = {};    // { BGH: 4, OGH: 23, ... }
			let total = 0;
			
			for (const key of sortedKeys) {
				const court = groupedEntries[key].court;
				counts[court] = (counts[court] || 0) + 1;
				total++;
			}
			
			// Format for output: "4× BGH, 2× EuGH, 23× OGH"
			const breakdown = Object.entries(counts)
				.sort(([a], [b]) => a.localeCompare(b))
				.map(([court, count]) => `${count}×&nbsp;${court}`)
				.join(', ');
			
			// Set the text of the <h5> summary line
			summaryH5.innerHTML = `Eine automatisiert generierte Liste, umfassend ${total} Entscheidungen (${breakdown}).`;
			
        }

        // Load all pages and process their content
        async function loadAndProcessPages() {
            const allEntries = [];
            for (const page of pages) {
                try {
                    const response = await fetch(page);
                    const htmlContent = await response.text();
                    const entries = extractCaseLaw(htmlContent, page);
                    allEntries.push(...entries);
                } catch (error) {
                    console.error(`Error loading ${page}:`, error);
                }
            }

            // Just pass the entries, sorting is done in displayCaseLaw
            displayCaseLaw(allEntries);

			// Insert footer only AFTER all dynamic content has been added
		    const footerHtml = `
		        <div class="columns">
		            <div class="wide epilog">
		                <a href="https://www.github.com">Quellcode</a>
		            </div>
		        </div>
		    `;
		    document
		        .getElementById('summary')
		        .insertAdjacentHTML('beforeend', footerHtml);
				}
		   
        // Run the script when the page loads
        //window.onload = loadAndProcessPages;
		document.addEventListener("DOMContentLoaded", loadAndProcessPages);
		   
    </script>
    <script src="script.js"></script>
      </body>
    </html>

